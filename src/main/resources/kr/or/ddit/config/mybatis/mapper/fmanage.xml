<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="fmanage">
	<!-- 시설관리 -->
	<!-- 시설리스트 조회 20210306_KJH 수정-->
	<select id="myfmanageList" resultType="fmanageVo">
		SELECT
		manage_no,owner,location,info,reg_dt,use_yn
		FROM fmanage
	</select>

	<!-- 등록된 시설 보는거 03/04 (경찬) -->
	<!-- 20210306KJH 수정 -->
	<select id="fmanageCount" parameterType="String"
		resultType="Integer">
		SELECT count(*)
		FROM fmanage
		WHERE owner = #{user_id}
	</select>

	<!-- 시설 상세 조회 -->
	<!-- 20210308KJH 수정 -->
	<select id="fmanageInfo" resultType="fmanageVo"
		parameterType="String">
	select fh.history_no history_no,fm.manage_no,fm.location,usr.user_nm
	owner,cod.code_nm item_code,mse.msr_nm use_yn
	from
	fhistory fh, fmanage fm,msrequip mse,users usr,codes cod
	where fh.release_dt &gt; sysdate
	and mse.msr_code = fh.msr_code
	and fm.owner = usr.user_id
	and cod.code_no = fm.item_code
	and fm.manage_no = #{manage_no}
	</select>

	<!--해당 시설의 가장 최근 센서 정보 조회 -->
	<!-- 20210308KJH 수정 -->
	<select id="latelyData" resultType="msrrecVo"
		parameterType="fhistoryVo">
		select mse.msr_reg_dt
		,mse.msr_temp
		,mse.msr_humid
		,mse.msr_bright from mserec mse,fhistory fh where
		mse.msr_reg_dt = (select max(ms.msr_reg_dt) msr_reg_dt from mserec ms, fhistory fh
		where ms.msr_code = fh.msr_code
		and fh.manage_no = #{manage_no})
		and mse.msr_code = fh.msr_code
		and fh.history_no = #{history_no}
	</select>

	<!-- 센서 기록 조회 -->
	<!-- 20210306KJH 삭제 -->
	<select id="myfanalysisInfo" resultType="msrrecVo">
		
	</select>

	<!-- 센서 목록 조회 -->
	<!-- 20210306KJH 삭제 -->
	<select id="msrequipList" resultType="msrequipVo" parameterType="String">
		
	</select>
	
	<!-- 내 시설 실시간 관측 -->
	<!-- 20210306KJH 삭제 -->
	<select id="mymaxmsrrecList" resultType="mymaxmrreclistVo" parameterType="msrrecVo">
	
	</select>
</mapper>